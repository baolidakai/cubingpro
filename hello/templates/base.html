{% load static %}
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Cubing Pro</title>

  <meta name="author" content="Bowen Deng">
  <meta name="description" content="Home for competitive speedcubers.">
  <meta name="keywords" content="rubik's cube, cubing, speedcubing, algorithms, algs">

  <link rel="stylesheet" href="{% static 'css/main.css' %}">
  <script async="" src="//www.google-analytics.com/analytics.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js" type="text/javascript"></script>
  <script src="{% static 'js/main.js' %}" type="text/javascript"></script>
  <script src="{% static 'js/vendor/jquery.ba-replacetext.min.js' %}"></script>
  <script src="{% static 'js/clock.js' %}" type="text/javascript"></script>
  <script src="{% static 'js/pyraminx.js' %}" type="text/javascript"></script>
  <script src="{% static 'js/big_cube.js' %}" type="text/javascript"></script>
  <script src="{% static 'js/skewb.js' %}" type="text/javascript"></script>
  <script src="{% static 'js/sq1.js' %}" type="text/javascript"></script>
  <script src="https://cdn.cubing.net/v0/js/cubing/twisty" type="module"></script>
  <script type="module">
    import "https://cdn.cubing.net/v0/js/cubing/twisty";
  </script>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const STATIC_BASE = "/static";
    fetch("{% static 'sidebar.json' %}")
      .then(response => response.json())
      .then(menuData => {
        function buildMenu(menuContainer, menuData) {
          // State
          let inCategoryView = false;

          function renderCategories(data) {
            menuContainer.innerHTML = ''; // Clear previous

            data.forEach(entry => {
              const card = document.createElement('div');
              card.className = 'category-card';

              const img = document.createElement('img');
              if (entry.category_logo && entry.category_logo.trim() !== '') {
                img.src = `${STATIC_BASE}${entry.category_logo}`;
              }
              img.alt = entry.category;
              img.className = 'card-image';

              const title = document.createElement('div');
              title.className = 'card-title';
              title.textContent = entry.category;

              card.appendChild(img);
              card.appendChild(title);

              card.addEventListener('click', () => {
                renderItems(entry.category, entry.items);
              });

              menuContainer.appendChild(card);
            });

            inCategoryView = false;
          }

          function renderItems(category, items) {
            menuContainer.innerHTML = '';

            // Back button
            const backButton = document.createElement('button');
            backButton.textContent = '← Back';
            backButton.className = 'back-button';
            backButton.onclick = () => renderCategories(menuData);
            menuContainer.appendChild(backButton);

            items.forEach(item => {
              const card = document.createElement('div');
              card.className = 'item-card';

              const img = document.createElement('img');
              if (item.logo && item.logo.trim() !== '') {
                img.src = `${STATIC_BASE}${item.logo}`;
              }
              img.alt = item.title;
              img.className = 'card-image';

              const title = document.createElement('div');
              title.className = 'card-title';
              title.textContent = item.title;

              card.appendChild(img);
              card.appendChild(title);

              card.addEventListener('click', () => {
                window.location.href = item.url;
              });

              menuContainer.appendChild(card);
            });

            inCategoryView = true;
          }

          // Initial render
          renderCategories(menuData);

          // Add copyright
          const copyright = document.createElement('div');
          copyright.className = 'copyright';
          copyright.textContent = '© 2025 Bowen Deng';
          menuContainer.appendChild(copyright);
        }

        const sidebarMenu = document.getElementById('sidebar-menu');
        const indexPage = document.getElementById('index-page');

        if (sidebarMenu) {
          buildMenu(sidebarMenu, menuData);
        }
        if (indexPage) {
          buildMenu(indexPage, menuData);
        }
      })
      .catch(err => console.error('Failed to load menu:', err));
  </script>
</head>

<body>
  <button id="nav-toggle"
    style="position: fixed; top: 10px; left: 10px; z-index: 1000; font-size: 1.5em; padding: 16px 32px;">Navigate</button>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const navToggle = document.getElementById('nav-toggle');
      const sidebar = document.getElementById('sidebar-menu');
      navToggle.addEventListener('click', () => {
        sidebar.classList.toggle('active');
        if (sidebar.classList.contains('active')) {
          sidebar.style.minHeight = '800px';
        } else {
          sidebar.style.minHeight = '';
        }
      });
      sidebar.querySelectorAll('a').forEach(link => {
        link.addEventListener('click', () => {
          sidebar.classList.remove('active');
        });
      });
    });
  </script>
  <div id="container">
    <div id="header">
      <h1 class="title" style="position: fixed; top: 0; left: 50%; margin: 0; padding: 10px;">
        <div
          style="position: absolute; top: 50px; left: 50%; transform: translateX(-80%); font-size: 15px; color: #e91e63; pointer-events: none;">
          &lt;- Can I get a forehead pat?
        </div>
        <button onclick="rainStars(this)"
          style="border: none; background: none; padding: 0; display: inline-block; line-height: 0; cursor: grab;">
          <img src="{% static 'fox_with_cube.png' %}" alt="" width="85" style="display: block;">
        </button>
        <a href="/">Cubing for Professionals</a>
      </h1>
    </div>

    <!-- To check the feedback from the solver app -->
    <!-- http://localhost:5006/execute_sql/ -->

    <div id="sidebar">
      <nav>
        <div id="sidebar-menu" class="sidebar-menu">
        </div>
      </nav>
      </nav>
    </div>

    <div id="content" class="home">
      <div id="home">

        <h1 class="watermark">cubingpro.com</h1>

        <div id="star-container"></div>

        {% block content %}{% endblock content %}

      </div>

    </div>
  </div> <!-- /container -->

  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1397403119979850"
    crossorigin="anonymous"></script>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-CK6MWC01K0"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-CK6MWC01K0');
  </script>

</body>

</html>